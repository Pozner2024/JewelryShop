document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",async r=>{const s=r.target.closest(".product-card__wishlist"),i=r.target.closest(".product-card__btn-remove");if(!s&&!i)return;r.preventDefault();const o=r.target.closest(".product-card, .product-detail__container");if(!o){console.error("Product container not found.");return}const n=o.dataset.productId;if(!n){console.error("Product ID not found.");return}if(i){try{const e=await(await fetch("/api/likes/toggle",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({productId:n})})).json();e.success&&!e.liked&&(o.style.transition="opacity 0.5s ease",o.style.opacity="0",setTimeout(()=>o.remove(),500))}catch(t){console.error("Error removing favorite:",t)}return}if(!document.getElementById("profileDropdown")){const t=document.getElementById("loginModal");t&&(t.classList.add("show"),document.body.style.overflow="hidden");return}try{const t=await fetch("/api/likes/toggle",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({productId:n})});if(t.status===401){alert("Please log in to like products."),window.location.href="/?login=true";return}if(!t.ok)throw new Error("Failed to toggle like status.");const e=await t.json();e.success&&s.classList.toggle("liked",e.liked)}catch(t){console.error("Error:",t)}})});
