(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();document.addEventListener("DOMContentLoaded",()=>{var I,L;const e=document.getElementById("profileBtn"),s=document.getElementById("loginModal"),n=document.getElementById("registerModal"),o=document.getElementById("userMenu"),r=document.getElementById("closeLoginModal"),c=document.getElementById("closeRegisterModal"),m=document.getElementById("showRegisterModal"),v=document.getElementById("showLoginModal"),y=document.getElementById("loginForm"),f=document.getElementById("registerForm"),h=document.getElementById("logoutBtn");S(),e&&e.addEventListener("click",t=>{t.preventDefault(),localStorage.getItem("isLoggedIn")==="true"?w():p(s)});function w(){if(!o)return;if(o.style.display==="none"||!o.style.display){o.style.display="block";const a=e.getBoundingClientRect();o.style.position="absolute",o.style.top=`${a.bottom+10}px`,o.style.left=`${a.left}px`}else o.style.display="none"}function p(t){t.style.display="flex",document.body.style.overflow="hidden"}function d(t){t.style.display="none",document.body.style.overflow="auto"}r==null||r.addEventListener("click",()=>d(s)),c==null||c.addEventListener("click",()=>d(n)),s==null||s.addEventListener("click",t=>t.target===s&&d(s)),n==null||n.addEventListener("click",t=>t.target===n&&d(n)),m==null||m.addEventListener("click",t=>{t.preventDefault(),d(s),p(n)}),v==null||v.addEventListener("click",t=>{t.preventDefault(),d(n),p(s)});function E(t,a=""){const i=document.getElementById("usernameDisplay");t?i.textContent=a:i.textContent=""}function S(){const t=localStorage.getItem("isLoggedIn")==="true",a=localStorage.getItem("username")||"";E(t,a)}f==null||f.addEventListener("submit",async t=>{t.preventDefault();const a=new FormData(f),i={username:a.get("username"),email:a.get("email"),password:a.get("password")};try{const g=await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),l=await g.json().catch(()=>({message:"Невозможно распарсить ответ"})),u=document.getElementById("registerStatusMessage");g.ok?(u.textContent="Регистрация прошла успешно! Теперь войдите.",u.className="status-message success",f.reset(),setTimeout(()=>{d(n),p(s)},1500)):(u.textContent=l.message||"Ошибка регистрации",u.className="status-message error")}catch{const l=document.getElementById("registerStatusMessage");l.textContent="Сетевая ошибка. Попробуйте позже.",l.className="status-message error"}}),y==null||y.addEventListener("submit",async t=>{t.preventDefault();const a=new FormData(y),i={email:a.get("email"),password:a.get("password")};try{const g=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),l=await g.json().catch(()=>({message:"Невозможно распарсить ответ"})),u=document.getElementById("loginStatusMessage");g.ok?(u.textContent="Вход выполнен!",u.className="status-message success",localStorage.setItem("isLoggedIn","true"),localStorage.setItem("username",l.user.username),localStorage.setItem("token",l.token),d(s),E(!0,l.user.username)):(u.textContent=l.message||"Ошибка входа",u.className="status-message error")}catch{const l=document.getElementById("loginStatusMessage");l.textContent="Сетевая ошибка. Попробуйте позже.",l.className="status-message error"}});const b=window.fetch;window.fetch=(t,a={})=>{const i=localStorage.getItem("token");return a.headers={...a.headers||{},...i?{"X-Session-Id":i}:{}},b(t,a)},h==null||h.addEventListener("click",t=>{t.preventDefault(),localStorage.clear(),d(o),E(!1)}),document.addEventListener("click",t=>{var i;const a=t.target.closest("a[href^='#']");a&&(t.preventDefault(),(i=document.getElementById(a.getAttribute("href").slice(1)))==null||i.scrollIntoView({behavior:"smooth",block:"start"}))});function _(t,a){t.type==="password"?(t.type="text",a.textContent="🙈"):(t.type="password",a.textContent="🙉")}(I=document.getElementById("loginPasswordToggle"))==null||I.addEventListener("click",()=>{const t=y.querySelector('[name="password"]');t&&_(t,document.getElementById("loginPasswordToggle"))}),(L=document.getElementById("registerPasswordToggle"))==null||L.addEventListener("click",()=>{const t=f.querySelector('[name="password"]');t&&_(t,document.getElementById("registerPasswordToggle"))})});document.addEventListener("DOMContentLoaded",()=>{k(),x(),B(),q(),C(),D()});function k(){const e=document.getElementById("mainProductImage");document.querySelectorAll(".product-gallery__thumb").forEach(s=>{s.addEventListener("click",()=>{document.querySelectorAll(".product-gallery__thumb--active").forEach(o=>o.classList.remove("product-gallery__thumb--active")),s.classList.add("product-gallery__thumb--active");const n=s.querySelector(".product-gallery__thumb-img");e&&n&&(e.src=n.src,e.alt=n.alt)})})}function x(){document.querySelectorAll(".size-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".size-btn--active").forEach(s=>s.classList.remove("size-btn--active")),e.classList.add("size-btn--active")})})}function B(){const e=document.querySelector(".quantity__input"),s=document.querySelector(".quantity__btn--minus"),n=document.querySelector(".quantity__btn--plus");!e||!s||!n||(s.addEventListener("click",()=>{const o=parseInt(e.min)||1;e.value=Math.max(parseInt(e.value)-1,o)}),n.addEventListener("click",()=>{const o=parseInt(e.max)||1/0;e.value=Math.min(parseInt(e.value)+1,o)}),e.addEventListener("change",()=>{const o=parseInt(e.value),r=parseInt(e.min)||1,c=parseInt(e.max)||1/0;e.value=isNaN(o)?r:Math.min(Math.max(o,r),c)}))}function q(){document.querySelectorAll(".tabs__btn").forEach(e=>{e.addEventListener("click",()=>{var n;const s=e.dataset.tab;document.querySelectorAll(".tabs__btn--active").forEach(o=>o.classList.remove("tabs__btn--active")),document.querySelectorAll(".tabs__panel--active").forEach(o=>o.classList.remove("tabs__panel--active")),e.classList.add("tabs__btn--active"),(n=document.querySelector(`.tabs__panel[data-panel="${s}"]`))==null||n.classList.add("tabs__panel--active")})})}function C(){document.querySelectorAll(".product-gallery__wishlist, .product-card__wishlist").forEach(e=>{e.addEventListener("click",s=>{s.preventDefault(),e.classList.toggle("wishlist--active");const n=e.querySelector(".product-gallery__heart, .product-card__heart");n&&(e.classList.contains("wishlist--active")?(n.style.fill="#e74c3c",e.title="Remove from wishlist"):(n.style.fill="none",e.title="Add to wishlist"))})})}function D(){document.querySelectorAll(".product-card").forEach(e=>{const s=e.dataset.slug;e.addEventListener("click",n=>{n.target.closest(".product-card__wishlist, .product-card__add-to-cart, .product-card__quick-view")||s&&(window.location.href=`/product/${s}`)}),e.style.cursor="pointer",e.addEventListener("mousedown",()=>e.style.transform="scale(0.98) translateY(-4px)"),["mouseup","mouseleave"].forEach(n=>e.addEventListener(n,()=>e.style.transform=""))})}document.addEventListener("click",e=>{if(e.target.matches(".product-info__btn-cart, .product-card__add-to-cart")&&(e.preventDefault(),M(e.target)),e.target.matches(".product-info__btn-buy")){e.preventDefault();const s=getProductData(e.target);showQuickOrderModal(s)}});function M(e){const s=e.textContent;e.textContent="Added!",e.disabled=!0,setTimeout(()=>{e.textContent=s,e.disabled=!1},1500)}
