document.addEventListener("DOMContentLoaded",function(){const s=document.querySelector(".header__search"),d=document.querySelector(".header__search-btn"),u=document.querySelector(".header__search-form"),r=document.querySelector(".header__search-input");let n,l=[],o=-1;if(!d||!u)return;d.addEventListener("click",function(e){e.stopPropagation(),s.classList.toggle("header__search--active"),s.classList.contains("header__search--active")&&r.focus()}),document.addEventListener("click",function(e){s.contains(e.target)||s.classList.remove("header__search--active")}),u.addEventListener("submit",function(e){e.preventDefault();const t=r.value.trim();t&&(window.location.href=`/catalog?search=${encodeURIComponent(t)}`)});function i(){n&&(n.remove(),n=null,l=[],o=-1)}function h(e){i(),e.length&&(n=document.createElement("ul"),n.className="search-autocomplete",e.forEach((t,a)=>{const c=document.createElement("li");c.textContent=t.name,c.tabIndex=0,c.className="search-autocomplete__item",c.addEventListener("mousedown",f=>{f.preventDefault(),window.location.href=`/product/${t.id}`}),n.appendChild(c)}),s.appendChild(n))}r.addEventListener("input",async function(){const e=r.value.trim();if(e.length<2){i();return}try{const a=await(await fetch(`/api/autocomplete?q=${encodeURIComponent(e)}`)).json();l=a,h(a)}catch{i()}}),r.addEventListener("blur",()=>{setTimeout(i,100)}),r.addEventListener("keydown",e=>{if(!n||!l.length)return;const t=Array.from(n.children);e.key==="ArrowDown"?(o=(o+1)%t.length,t.forEach((a,c)=>a.classList.toggle("active",c===o)),e.preventDefault()):e.key==="ArrowUp"?(o=(o-1+t.length)%t.length,t.forEach((a,c)=>a.classList.toggle("active",c===o)),e.preventDefault()):e.key==="Enter"&&o>=0&&(window.location.href=`/product/${l[o].id}`,i(),e.preventDefault())})});
